<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Distribution Center Details - Clothes Warehouse</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container-fluid mt-4">
      <!-- Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h2 class="text-primary mb-1">
                <i class="fas fa-building me-2"></i>
                <span th:text="${distributionCenter.name}"
                  >Distribution Center</span
                >
              </h2>
              <p class="text-muted mb-0">
                <i class="fas fa-map-marker-alt me-1"></i>
                <span
                  th:text="${distributionCenter.latitude + '°N, ' + distributionCenter.longitude + '°W'}"
                  >Location</span
                >
                <span class="ms-3">
                  <i class="fas fa-route me-1"></i>
                  <span
                    th:text="${distributionCenter.distanceFromWarehouse + ' km from warehouse'}"
                    >Distance</span
                  >
                </span>
              </p>
            </div>
            <div>
              <a href="/admin/dashboard" class="btn btn-outline-secondary me-2">
                <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
              </a>
              <button
                type="button"
                class="btn btn-success"
                data-bs-toggle="modal"
                data-bs-target="#addItemModal"
              >
                <i class="fas fa-plus me-2"></i>Add Item
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Success/Error Messages -->
      <div class="row mb-3" th:if="${successMessage}">
        <div class="col-12">
          <div
            class="alert alert-success alert-dismissible fade show"
            role="alert"
          >
            <i class="fas fa-check-circle me-2"></i>
            <span th:text="${successMessage}"></span>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
            ></button>
          </div>
        </div>
      </div>

      <div class="row mb-3" th:if="${errorMessage}">
        <div class="col-12">
          <div
            class="alert alert-danger alert-dismissible fade show"
            role="alert"
          >
            <i class="fas fa-exclamation-circle me-2"></i>
            <span th:text="${errorMessage}"></span>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
            ></button>
          </div>
        </div>
      </div>

      <!-- Items Table -->
      <div class="row">
        <div class="col-12">
          <div class="card shadow">
            <div class="card-header bg-white">
              <h5 class="mb-0">
                <i class="fas fa-boxes me-2"></i>Items in Distribution Center
                <span
                  class="badge bg-primary ms-2"
                  th:text="${distributionCenter.itemCount}"
                  >0</span
                >
              </h5>
            </div>
            <div class="card-body p-4">
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Brand</th>
                      <th>Category</th>
                      <th>Price</th>
                      <th>Year</th>
                      <th>Quantity</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="item : ${distributionCenter.items}">
                      <td th:text="${item.id}"></td>
                      <td>
                        <strong th:text="${item.name}"></strong>
                      </td>
                      <td>
                        <span
                          class="badge bg-info"
                          th:text="${item.brand}"
                        ></span>
                      </td>
                      <td th:text="${item.category}"></td>
                      <td>
                        <span class="text-success fw-bold">
                          $<span
                            th:text="${#numbers.formatDecimal(item.price, 1, 2)}"
                          ></span>
                        </span>
                      </td>
                      <td th:text="${item.year}"></td>
                      <td>
                        <span
                          class="badge bg-warning text-dark"
                          th:text="${item.quantity}"
                        ></span>
                      </td>
                      <td>
                        <button
                          class="btn btn-sm btn-outline-danger"
                          title="Delete Item"
                          data-bs-toggle="modal"
                          data-bs-target="#deleteModal"
                          th:data-item-id="${item.id}"
                          th:data-item-name="${item.name}"
                          th:data-item-brand="${item.brand}"
                          th:data-center-id="${distributionCenter.id}"
                        >
                          <i class="fas fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(distributionCenter.items)}">
                      <td colspan="8" class="text-center py-4">
                        <i class="fas fa-box-open fa-2x text-muted mb-2"></i>
                        <p class="text-muted">
                          No items found in this distribution center
                        </p>
                        <button
                          type="button"
                          class="btn btn-primary"
                          data-bs-toggle="modal"
                          data-bs-target="#addItemModal"
                        >
                          <i class="fas fa-plus me-2"></i>Add First Item
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Item Modal -->
    <div
      class="modal fade"
      id="addItemModal"
      tabindex="-1"
      aria-labelledby="addItemModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-success text-white">
            <h5 class="modal-title" id="addItemModalLabel">
              <i class="fas fa-plus me-2"></i>Add Item to Distribution Center
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <form
            th:action="@{/admin/distribution-center/{id}/add-item(id=${distributionCenter.id})}"
            method="post"
          >
            <div class="modal-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="itemName" class="form-label">Item Name *</label>
                  <input
                    type="text"
                    class="form-control"
                    id="itemName"
                    name="name"
                    placeholder="Enter item name"
                    required
                  />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="itemBrand" class="form-label">Brand *</label>
                  <select
                    class="form-select"
                    id="itemBrand"
                    name="brand"
                    required
                  >
                    <option value="">Select Brand</option>
                    <option value="Nike">Nike</option>
                    <option value="Adidas">Adidas</option>
                    <option value="Levi's">Levi's</option>
                    <option value="Calvin Klein">Calvin Klein</option>
                    <option value="Tommy Hilfiger">Tommy Hilfiger</option>
                    <option value="Puma">Puma</option>
                    <option value="Under Armour">Under Armour</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="itemCategory" class="form-label"
                    >Category *</label
                  >
                  <select
                    class="form-select"
                    id="itemCategory"
                    name="category"
                    required
                  >
                    <option value="">Select Category</option>
                    <option value="Shoes">Shoes</option>
                    <option value="Shirts">Shirts</option>
                    <option value="Pants">Pants</option>
                    <option value="Jackets">Jackets</option>
                    <option value="Shorts">Shorts</option>
                    <option value="Hoodies">Hoodies</option>
                    <option value="Sweaters">Sweaters</option>
                    <option value="Dresses">Dresses</option>
                    <option value="Blazers">Blazers</option>
                    <option value="Underwear">Underwear</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="itemYear" class="form-label">Year *</label>
                  <input
                    type="number"
                    class="form-control"
                    id="itemYear"
                    name="year"
                    value="2024"
                    min="2020"
                    max="2030"
                    required
                  />
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="itemPrice" class="form-label">Price *</label>
                  <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input
                      type="number"
                      class="form-control"
                      id="itemPrice"
                      name="price"
                      placeholder="0.00"
                      step="0.01"
                      min="0"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="itemQuantity" class="form-label"
                    >Quantity *</label
                  >
                  <input
                    type="number"
                    class="form-control"
                    id="itemQuantity"
                    name="quantity"
                    value="1"
                    min="1"
                    max="1000"
                    required
                  />
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-success">
                <i class="fas fa-plus me-2"></i>Add Item
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div
      class="modal fade"
      id="deleteModal"
      tabindex="-1"
      aria-labelledby="deleteModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title" id="deleteModalLabel">
              <i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="d-flex align-items-center">
              <i class="fas fa-trash-alt fa-3x text-danger me-3"></i>
              <div>
                <h6 class="mb-1">Are you sure you want to delete this item?</h6>
                <p class="text-muted mb-0">
                  <strong id="deleteItemName"></strong> by
                  <strong id="deleteItemBrand"></strong>
                </p>
                <small class="text-warning">
                  <i class="fas fa-exclamation-triangle me-1"></i>
                  This action cannot be undone.
                </small>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <form id="deleteForm" method="post" style="display: inline">
              <input
                type="hidden"
                th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}"
              />
              <button type="submit" class="btn btn-danger">
                <i class="fas fa-trash me-2"></i>Delete Item
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Handle delete modal
      document.addEventListener("DOMContentLoaded", function () {
        const deleteModal = document.getElementById("deleteModal");
        const deleteForm = document.getElementById("deleteForm");
        const deleteItemName = document.getElementById("deleteItemName");
        const deleteItemBrand = document.getElementById("deleteItemBrand");

        deleteModal.addEventListener("show.bs.modal", function (event) {
          const button = event.relatedTarget;
          const itemId = button.getAttribute("data-item-id");
          const itemName = button.getAttribute("data-item-name");
          const itemBrand = button.getAttribute("data-item-brand");
          const centerId = button.getAttribute("data-center-id");

          deleteItemName.textContent = itemName;
          deleteItemBrand.textContent = itemBrand;
          deleteForm.action = `/admin/distribution-center/${centerId}/delete-item/${itemId}`;
        });
      });
    </script>
  </body>
</html>
